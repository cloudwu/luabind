fork form https://blog.codingnow.com/2015/05/lua_c_api.html